# mise configuration for tinywhale monorepo
[tools]
node = "24.12.0"
pnpm = "10.26.0"

[tasks.install]
description = "Install dependencies"
run = "pnpm install"

[tasks.update]
description = "Update dependencies"
run = "pnpm up --workspace --interactive --recursive --latest"

[tasks.generate-grammar]
description = "Generate Ohm grammar bundles with TypeScript types"
run = "cd packages/compiler && npx @ohm-js/cli generateBundles --withTypes --esm 'src/parse/*.ohm'"

[tasks.build]
description = "Build all packages"
depends = ["generate-grammar"]
run = "pnpm -r build"

[tasks.test]
description = "Run tests for all packages"
run = "pnpm -r test"

[tasks.check]
description = "Run biome check (lint & format)"
run = "pnpm exec biome check --write --max-diagnostics 100"

[tasks.typecheck]
description = "Run TypeScript type checking"
run = "pnpm exec tsc"

[tasks.clean]
description = "Clean build artifacts"
run = "pnpm -r clean"

[tasks.cli]
description = "Run the TinyWhale CLI build command"
depends = ["clean", "build"]
usage = 'arg "<file>" help="TinyWhale source file to compile"'
run = "node packages/cli/dist/cli.js build ${usage_file?}"
